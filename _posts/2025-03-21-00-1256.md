---
layout: post
title:  "Cocos drawSegment绘制的线条以及一张图里的线条出现不显示或者粗细不一的问题"
image: ''
date:   2025-03-21 10:16:14
tags:
- Cocos
description: ''
categories: 
- Cocos
---

## 光栅化的像素采样规则
### OpenGL 采用中心采样（Pixel Center Sampling），即：
* 每个像素的中心点决定该像素是否被填充。
![图片](..\assets\img\cocos\drawline.png)

注意看图上的三种情况(假设线条宽度是1像素)。  
**次像素精度误差**
即由于精度问题转换成整数的时候会出现精度损失。
比如理论上应该表示成100的浮点数,由于浮点误差可能会出现99.99这种情况,也有可能是100.01这种。
总之可能比理论值大也可能比理论值小。


第一种情况是由于误差导致线条一个像素点的中心都没有经过,进而导致线条不显示。  
第二种就是比较正常的,恰好满足在经过一行的像素点,可以绘制出一条一个像素宽的线条。
第三种是由于误差导致经过上下两排的像素中心点,进而显示的线条比较粗。

结论:
```
如果要绘制线条的话,不要使用GL_TRIANGLES,
应该使用GL_LINES,然后通过glLineWidth(_lineWidth);设置线条宽度
```

PS:
有些带网格的图片也会出现这种情况的问题,解决方案就是不要带网格的图片,如果非要显示网格就用GL_LINES自己绘制。